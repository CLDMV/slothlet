# Slothlet v2.1.0 Changelog

**Release Date**: September 16, 2025

## Overview

Version 2.1.0 introduces advanced sanitization control with boundary patterns, glob matching, and rule-based transformations. This release gives developers fine-grained control over how filenames are transformed into API property names while maintaining complete backward compatibility.

## üîß New Features

### Advanced Sanitization Control

New `sanitize` option in slothlet constructor provides sophisticated control over filename-to-API transformations:

**Boundary Patterns (`**string**`):**

- Transformations only apply when the pattern is surrounded by other characters
- Prevents unintended transformations at segment boundaries
- Example: `**url**` matches `parseUrl` but not `url` alone

**Glob Pattern Support:**

- Wildcard matching with `*` and `?` for flexible rules
- Match multiple variations without explicit enumeration
- Example: `*json*` matches `parseJson`, `toJson`, `jsonParser`

**Rule Types:**

- **`leave`**: Preserve exact casing (case-sensitive)
- **`leaveInsensitive`**: Preserve casing (case-insensitive matching)
- **`upper`**: Force uppercase transformation
- **`lower`**: Force lowercase transformation

**Rule Precedence System:**

```plaintext
leave > leaveInsensitive > upper > lower
```

### Usage Example

```javascript
import slothlet from "@cldmv/slothlet";

const api = await slothlet({
	dir: "./api",
	sanitize: {
		lowerFirst: true,
		rules: {
			leave: ["IP", "JSON", "XML"], // Exact matches preserved
			leaveInsensitive: ["**url**", "**api**"], // Boundary patterns
			upper: ["*id*"], // Glob wildcards
			lower: ["config*"]
		}
	}
});

// Results:
// auto-ip.mjs ‚Üí api.autoIP (preserved via leave rule)
// parse-json.mjs ‚Üí api.parseJSON (preserved via leave rule)
// get-url-params.mjs ‚Üí api.getUrlParams (url preserved via boundary pattern)
// user-id-validator.mjs ‚Üí api.userIDValidator (id uppercase via glob)
// config-loader.mjs ‚Üí api.configLoader (config lowercase via glob)
```

## üìä Enhancements

### Documentation Improvements

- Comprehensive sanitize options documentation in README
- Detailed API reference with pattern examples
- GitHub links converted to absolute URLs using HEAD for universal compatibility
- Fixed emoji rendering issues across documentation

### Testing Infrastructure

- 242 lines of new test coverage in `tests/test-sanitize.mjs`
- Complete validation of all pattern types and rule precedence
- Edge case handling verification
- Mixed rule type testing

## üõ†Ô∏è Technical Details

### Pattern Matching Logic

**Boundary Detection:**

```javascript
// **url** pattern matching
"parseUrl"  ‚Üí matches (url surrounded by parse and end)
"url"       ‚Üí no match (not surrounded)
"urlParser" ‚Üí matches (url surrounded by start and Parser)
```

**Pre-Split Processing:**

- Patterns applied to full filename before camelCase splitting
- Preserves user intent across segment boundaries
- Intelligent within-segment transformations

### Safe Fallbacks

- Invalid glob patterns handled gracefully
- Malformed boundary patterns fall back to exact matching
- Comprehensive error handling prevents transformation failures

## üßπ Cleanup

- Removed temporary test files (test-helpers.mjs, test-normalization.mjs, test-normalize.mjs)
- Code formatting improvements throughout sanitization module
- Enhanced JSDoc documentation with clear examples
- TypeScript definitions updated to reflect new options

## Breaking Changes

None - all changes are backward compatible. Existing code continues to work without modification.

## Performance Impact

Minimal - sanitization occurs only during initial API loading phase, with no runtime overhead.

## Migration Guide

### Upgrading from v2.0.x

No code changes required. To take advantage of new features:

```javascript
// Before (still works)
const api = await slothlet({ dir: "./api" });

// After (with advanced control)
const api = await slothlet({
	dir: "./api",
	sanitize: {
		lowerFirst: true,
		preserveAllUpper: false,
		preserveAllLower: false,
		rules: {
			leave: ["IP", "JSON", "API"],
			leaveInsensitive: ["**url**", "**http**"],
			upper: ["*id"],
			lower: ["config"]
		}
	}
});
```

## Related Documentation

- [API Flattening Rules](../API-FLATTENING.md) - Complete flattening rule reference
- [Module Structure Guide](../MODULE-STRUCTURE.md) - Organization patterns
- [API Documentation](../generated/API.md) - Complete API reference

---

**Full Changelog**: https://github.com/CLDMV/slothlet/compare/v2.0.0...v2.1.0
